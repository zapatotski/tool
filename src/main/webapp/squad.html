<HEAD>
<META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">
<META HTTP-EQUIV="EXPIRES" CONTENT="-1">
<META charset="utf-8">


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
</HEAD>

<script>

var sumatop11starta=[];
var sumavstarte=[];
var klkgamevtable=0;
var obj=[];

var jaro_winkler = {};

jaro_winkler.adjustments = {
  'A': 'E',
  'A': 'I',
  'A': 'O',
  'A': 'U',
  'B': 'V',
  'E': 'I',
  'E': 'O',
  'E': 'U',
  'I': 'O',
  'I': 'U',
  'O': 'U',
  'I': 'Y',
  'E': 'Y',
  'C': 'G',
  'E': 'F',
  'W': 'U',
  'W': 'V',
  'X': 'K',
  'S': 'Z',
  'X': 'S',
  'Q': 'C',
  'U': 'V',
  'M': 'N',
  'L': 'I',
  'Q': 'O',
  'P': 'R',
  'I': 'J',
  '2': 'Z',
  '5': 'S',
  '8': 'B',
  '1': 'I',
  '1': 'L',
  '0': 'O',
  '0': 'Q',
  'C': 'K',
  'G': 'J',
  'E': ' ',
  'Y': ' ', 
  'S': ' '
}


function jaro(a, b) {

  if (!a || !b) { return 0.0; }

  a = a.trim().toUpperCase();
  b = b.trim().toUpperCase();
  var a_len = a.length;
  var b_len = b.length;
  var a_flag = []; var b_flag = [];
  var search_range = Math.floor(Math.max(a_len, b_len) / 2) - 1;
  var minv = Math.min(a_len, b_len);

  // Looking only within the search range, count and flag the matched pairs. 
  var Num_com = 0;
  var yl1 = b_len - 1;
  for (var i = 0; i < a_len; i++) {
    var lowlim = (i >= search_range) ? i - search_range : 0;
    var hilim  = ((i + search_range) <= yl1) ? (i + search_range) : yl1;
    for (var j = lowlim; j <= hilim; j++) {
      if (b_flag[j] !== 1 && a[j] === b[i]) {
        a_flag[j] = 1;
        b_flag[i] = 1;
        Num_com++;
        break;
      }
    }
  }

  // Return if no characters in common
  if (Num_com === 0) { return 0.0; }

  // Count the number of transpositions
  var k = 0; var N_trans = 0;
  for (var i = 0; i < a_len; i++) {
    if (a_flag[i] === 1) {
      var j;
      for (j = k; j < b_len; j++) {
        if (b_flag[j] === 1) {
          k = j + 1;
          break;
        }
      }
      if (a[i] !== b[j]) { N_trans++; }
    }
  }
  N_trans = Math.floor(N_trans / 2);

  // Adjust for similarities in nonmatched characters
  var N_simi = 0; var adjwt = jaro_winkler.adjustments;
  if (minv > Num_com) {
    for (var i = 0; i < a_len; i++) {
      if (!a_flag[i]) {
        for (var j = 0; j < b_len; j++) {
          if (!b_flag[j]) {
            if (adjwt[a[i]] === b[j]) {
              N_simi += 3;
              b_flag[j] = 2;
              break;
            }
          }
        }
      }
    }
  }

  var Num_sim = (N_simi / 10.0) + Num_com;

  // Main weight computation
  var weight = Num_sim / a_len + Num_sim / b_len + (Num_com - N_trans) / Num_com;
  weight = weight / 3;

  // Continue to boost the weight if the strings are similar
  if (weight > 0.7) {
    // Adjust for having up to the first 4 characters in common
    var j = (minv >= 4) ? 4 : minv;
    var i;
    for (i = 0; (i < j) && a[i] === b[i]; i++) { }
    if (i) { weight += i * 0.1 * (1.0 - weight) };

    // Adjust for long strings.
    // After agreeing beginning chars, at least two more must agree
    // and the agreeing characters must be more than half of the
    // remaining characters.
    if (minv > 4 && Num_com > i + 1 && 2 * Num_com >= minv + i) {
      weight += (1 - weight) * ((Num_com - i - 1) / (a_len * b_len - i*2 + 2));
    }
  }

  return weight
  
};


function sopostav(a,b){
	a=unescape(a);
	b=unescape(b);
	var arr=b.split(' ');
	var masskof=[];
	for(var i=0;i<arr.length;i++){
		var kof=jaro(a.split(' ').pop(),arr[i]);
		masskof.push(kof);
	}
	return Math.max.apply(null,masskof);
}


function sound(){
	$('#chatAudio')[0].play();
}

function time(timeend) {
    pam=timeend;
    today = new Date();
    today = Math.floor((timeend-today)/1000);
    tsec=today%60; today=Math.floor(today/60); if(tsec<10)tsec='0'+tsec;
    tmin=today%60; today=Math.floor(today/60); if(tmin<10)tmin='0'+tmin;
    timestr=tmin+" минут "+tsec+" секунд";
    document.getElementById('t').innerHTML=timestr;
    window.setTimeout("time(pam)",1000);
}

function deleteModalsWithoutOpen(){
	//udalaem modalnie okna krome otkritogo 
	var x=document.getElementsByClassName("modal show");
	var sohrmodal=-1;
	for(l=0;l<x.length;l++){
	   sohrmodal=x[l].getAttribute("id");
	}

	var md=document.getElementsByClassName("modals")[0];
	var y=document.getElementsByClassName("modals")[0].children;
	var numb=y.length;
	for(l=0;l<numb;l++){
	   if(y[l].getAttribute("id")!=("a"+sohrmodal)){
	     md.removeChild(y[l]);
	     l--;
	     numb--;
	   }
	}
	return sohrmodal;
}

function drawSquadApplication(teamNumber,i,plind){
	if($('#cl'+i).find('#buttonPanel'+teamNumber).find('#squad_application'+plind).is(":checked")){
		$('#'+i+'teamData'+teamNumber).find('#t'+plind).find('.squad_start_table').addClass('red_circle');
		var minut=+$('#'+i+'teamData'+teamNumber).find('#t'+plind).find('.game_minutes_cell').eq(0).text();
		sumavstarte[teamNumber]=sumavstarte[teamNumber]+minut;
		var res=((sumavstarte[teamNumber]/sumatop11starta[teamNumber])*100).toString().substring(0,4);
		$('#'+i+'resultstart'+teamNumber).html('<i><b>'+res+'<br>%</b></i>');
		var klk=+$('#cl'+i).find('#buttonPanel'+teamNumber).find('#resbut'+teamNumber).text();
		$('#cl'+i).find('#buttonPanel'+teamNumber).find('#resbut'+teamNumber).html('<i><b>'+(klk+1)+'</b></i>');
	}
	else{
		$('#'+i+'teamData'+teamNumber).find('#t'+plind).find('.squad_start_table').removeClass('red_circle');
		var minut=+$('#'+i+'teamData'+teamNumber).find('#t'+plind).find('.game_minutes_cell').eq(0).text();
		sumavstarte[teamNumber]=sumavstarte[teamNumber]-minut;
		var res=((sumavstarte[teamNumber]/sumatop11starta[teamNumber])*100).toString().substring(0,4);
		$('#'+i+'resultstart'+teamNumber).html('<i><b>'+res+'<br>%</b></i>');
		var klk=+$('#cl'+i).find('#buttonPanel'+teamNumber).find('#resbut'+teamNumber).text();
		$('#cl'+i).find('#buttonPanel'+teamNumber).find('#resbut'+teamNumber).html('<i><b>'+(klk-1)+'</b></i>');
	}
}


function getArrayStartAndZamena(teamNumber,a,i){
	
	var start=$(a).find('st'+teamNumber);
	var zamena=$(a).find('zm'+teamNumber);
	
	var knt=0;
    var sopkof=[];
	var masStart=[];
    var masZamena=[];
    var sumstart=0;
    var sumitogo=0;
    var klkvstarte=0;

    $('#cl'+i).find('#textFormat'+teamNumber).append('<b>Сопоставили (пришло имя ## в стате имя):</b><br>');
    //kazdiy igrok iz starta
    for (var j = 0; j < start.length; j++) {
	     //esli id=-1, to sravnivaem po familiam
	    if(start[j].childNodes[1].innerHTML==-1){
	    	var p=0;
	    	var arr=[];
	    	var allkof=[];
	    	var allname=[];
            //dly kazdogo igroka iz spiska komandy
	     	$(a).find('team'+teamNumber).find('players').each(function(){
		        //summa minut pervih 11
		        if(knt<11)
		           sumitogo=+sumitogo + +$(this).find('min').text();
		     	//schitaem kof
		     	var kf=sopostav($(this).find('name').text(),start[j].childNodes[2].innerHTML);
		        if(kf>0.85){
                    arr[p]=kf;
		        	p++;
		        	arr[p]=$(this).find('min').text();
		        	p++;
		        	arr[p]=$(this).find('name').text();
		        	p++;
		            //console.log(start1[j].childNodes[2].innerHTML+' '+$(this).find('name').text()+' '+kf);
		        }
		        allkof.push(kf);
		        allname[kf]=$(this).find('num').text()+' '+$(this).find('name').text();
		        knt++;
		    });
		    sopkof[j]=arr;
		    //console.log('-----------------------------------');
            if(arr.length==0){
            	$('#cl'+i).find('#textFormatTop'+teamNumber).append(start[j].childNodes[0].innerHTML+' '+start[j].childNodes[2].innerHTML+' ~~~ '+allname[Math.max.apply(null,allkof)]+'('+Math.max.apply(null,allkof).toString().substring(0,4)+')<br>');
            }
            else{
            	if(arr.length==3){
            		$('#cl'+i).find('#textFormat'+teamNumber).append(start[j].childNodes[2].innerHTML+' ## '+arr[2]+'('+arr[0].toString().substring(0,4)+')<br>');
            		masStart.push(arr[2]);
            		sumstart=+sumstart + +arr[1];
            		klkvstarte++;
            	}
            	else{
            		var arrsop=[];
            		var t=0;
            		var textstr='';
            		var maxkf=0;
            		var maxkfindex=0;            		
            		for(var e=0;e<arr.length;e=e+3){
            			if(arr[e]>maxkf){
            				maxkf=arr[e]
            				maxkfindex=e;
            		    }
            			if(e==arr.length-3)
            				textstr+=arr[e+2]+'('+arr[e].toString().substring(0,5)+')';
            			else
            				textstr+=arr[e+2]+'('+arr[e].toString().substring(0,5)+') и ';
            		}
            		sumstart=+sumstart + +arr[maxkfindex+1];
            		klkvstarte++;
            		$('#cl'+i).find('#textFormat'+teamNumber).append(start[j].childNodes[2].innerHTML+' ## '+arr[maxkfindex+2]+' ('+textstr+')<br>');
            		masStart.push(arr[maxkfindex+2]);           		
            	}
            }
        }
	    else{
	    	$(a).find('team'+teamNumber).find('players').each(function(){
	    		if(knt<11)
		           sumitogo=+sumitogo + +$(this).find('min').text();
		        knt++;
		        if($(this).find('id').text()==start[j].childNodes[1].innerHTML){
		        	masStart.push($(this).find('name').text());
		            sumstart=+sumstart + +$(this).find('min').text();
		            klkvstarte++;
		        }
		    });
	     }
    }



     //the same for zamena
    for (var j = 0; j < zamena.length; j++) {
	     //esli id=-1, to sravnivaem po familiam
	    if(zamena[j].childNodes[1].innerHTML==-1){
	    	var p=0;
	    	var arr=[];
	    	var allkof=[];
	    	var allname=[];
            //dly kazdogo igroka iz spiska komandy
	     	$(a).find('team'+teamNumber).find('players').each(function(){
		     	//schitaem kof
		     	var kf=sopostav($(this).find('name').text(),zamena[j].childNodes[2].innerHTML);
		        if(kf>0.85){
                    arr[p]=kf;
		        	p++;
		        	arr[p]=$(this).find('min').text();
		        	p++;
		        	arr[p]=$(this).find('name').text();
		        	p++;		           
		        }
		        allkof.push(kf);
		        allname[kf]=$(this).find('name').text();
		    });
		    sopkof[j]=arr;
		    //console.log('-----------------------------------');
            if(arr.length==0){
            }
            else{
            	if(arr.length==3){
            		masZamena.push(arr[2]);
            	}
            	else{
            		var arrsop=[];
            		var t=0;
            		var textstr='';
            		var maxkf=0;
            		var maxkfindex=0;            		
            		for(var e=0;e<arr.length;e=e+3){
            			if(arr[e]>maxkf){
            				maxkf=arr[e]
            				maxkfindex=e;
            		    }
            			if(e==arr.length-3)
            				textstr+=arr[e+2]+'('+arr[e]+','+arr[e+1]+')';
            			else
            				textstr+=arr[e+2]+'('+arr[e]+','+arr[e+1]+') и ';
            		}
            		masZamena.push(arr[maxkfindex+2]);           		
            	}
            }
        }
	    else{
	    	$(a).find('team'+teamNumber).find('players').each(function(){
		        if($(this).find('id').text()==zamena[j].childNodes[1].innerHTML){
		        	masZamena.push($(this).find('name').text());
		        }
		    });
	     }
    }


    var result=[];
    result[0]=masStart;
    result[1]=masZamena;
    result[2]=sumstart;
    result[3]=sumitogo;
    result[4]=klkvstarte;
    return result;
}

function formTable(teamNumber,a,teamLast,i,namegame,teamName,sumstart,sumitogo,klkvstarte,feed){
	var arr=teamLast.first().find('tournament').text().split(' ');
	var l1name=(arr.length==2)?(arr[0]+'<br>'+arr[1]):(arr[0]);
	var arr=teamLast.eq(1).find('tournament').text().split(' ');
	var l2name=(arr.length==2)?(arr[0]+'<br>'+arr[1]):(arr[0]);
	var arr=teamLast.eq(2).find('tournament').text().split(' ');
	var l3name=(arr.length==2)?(arr[0]+'<br>'+arr[1]):(arr[0]);

	var start=$(a).find('st'+teamNumber);
	var zamena=$(a).find('zm'+teamNumber);

	//zapolnyaem modalnoe okno
	//ozdaem obolochku moda okna
	if(teamNumber==1){
		$('#a'+i).append('<div id="'+i+'" class="modal fade">');
	    $('#'+i).append('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+namegame+'</h4><button class="close" type="button" data-dismiss="modal">X</button></div><div class="modal-body" id="cl'+i+'">');
	}

    $('#cl'+i).append('<div id="team'+teamNumber+'"><div id="textFormatTop'+teamNumber+'" style="display: block; width: inherit; height: auto;min-height:50px;"></div><div id="teamTable'+teamNumber+'"><div id="'+i+'teamData'+teamNumber+'" class="teamData'+teamNumber+'"><div class="teamDataTitle"><span class="shirtnumber"></span><span class="name" id="titleTeam'+teamNumber+'">'+teamName+'</span><span class="squad_preliminary_table"></span><span class="squad_start_table"></span><span class="last_game_1" id="last_game1_team1_title">'+l1name+'</span><span class="last_game_2" id="last_game2_team1_title">'+l2name+'</span><span class="last_game_3" id="last_game3_team1_title">'+l3name+'</span><span class="age">A</span><span class="position">P</span><span class="game_minutes"><img src="image/team_table/minute_played.png"></span><span class="appearances"><img src="image/team_table/appearance.png"></span><span class="lineups"><img src="image/team_table/lineup.png"></span><span class="subs_in"><img src="image/team_table/sub_in.png"></span><span class="subs_out"><img src="image/team_table/sub_out.png"></span><span class="subs_on_bench"><img src="image/team_table/sub_on_bench.png"></span><span class="goals"><img src="image/team_table/goal.png"></span><span class="assists"><img src="image/team_table/assist.png"></span><span class="yellow_cards"><img src="image/team_table/yellow_card.png"></span><span class="yellow_2_cards"><img src="image/team_table/yellow_red_card.png"></span><span class="red_cards"><img src="image/team_table/red_card.png"></span></div></div></div><div id="textFormat'+teamNumber+'" style="display: block; width: inherit; height: auto;min-height:50px;"></div></div>');


    if(teamNumber==1){
		$('#cl'+i).find('#teamTable'+teamNumber).prepend('<div id="buttonPanel'+teamNumber+'"><div class="buttonPanelTitle"><span class="squad_application"><img src="image/circle/red.png" title="Стартовый состав"></span></div></div>');
		
    }
    else{
		$('#cl'+i).find('#teamTable'+teamNumber).append('<div id="buttonPanel'+teamNumber+'"><div class="buttonPanelTitle"><span class="squad_application"><img src="image/circle/red.png" title="Стартовый состав"></span></div></div>');
    }

  
    
    var resultArr=getArrayStartAndZamena(teamNumber,a,i);
    
    var masStart=resultArr[0];
    var masZamena=resultArr[1];
    var sumstart=resultArr[2];
    var sumitogo=resultArr[3];
    var klkvstarte=resultArr[4];   


    var knt=0;
    var sumlast1=0;
    var sumlast2=0;
    var sumlast3=0;
 
    //chtob poniat kogda stroku result vivodit
    var vsegoplayers= $(a).find('team'+teamNumber).find('players').length;

    var plind=0;

    $('#cl'+i).find('#textFormat'+teamNumber).append('<br><b>Пришло:</b><br>');
    for (var j = 0; j < start.length; j++) {
      $('#cl'+i).find('#textFormat'+teamNumber).append(start[j].childNodes[2].innerHTML+'<br>');
    }


    //dly kazdogo player
    $(a).find('team'+teamNumber).find('players').each(function(){
        var odd="even";
        if(knt%2==0)
            odd="odd";
        
        
        var boolstart=false;
        var boolzam=false;
        var pred=false;

        //probegaem po start1 komandy i sravnivaem s tekuchim player, esli on tam est to boolstart=true i plusuem ego minuti k sume minut starta
        for (var j = 0; j < start.length; j++) {

        	if(start[j].getAttribute("idpr")!=-1){
        		if($(this).find('id').text()==start[j].getAttribute("idpr")){
                    pred=true;
                }
        	}
        	if(start[j].getAttribute("numpr")!=-1){
        		if($(this).find('num').text()==start[j].getAttribute("numpr")){
                    pred=true;
                }
        	}
        }


       for(var et=0;et<masStart.length;et++){
        	if($(this).find('name').text()==masStart[et]){
        		boolstart=true;
        	}
        }


       for(var et=0;et<masZamena.length;et++){
        	if($(this).find('name').text()==masZamena[et]){
        		boolzam=true;
        	}
        }


        var znakpred="";
        if(pred){
        	znakpred="blue_circle";
        }

        var osn="";
        if(boolstart){
          osn="red_circle";
        }
        
        //esli player v starte i feed=0, to eto predvarilovka
        if(boolstart && (feed == 0))
          osn="blue_circle"; 
       
        if(boolzam)
          osn="yellow_circle";


        var last1=false;
        var last2=false;
        var last3=false;
        var lzam1=false;
        var lzam2=false;
        var lzam3=false;        
        

        //tekushiy player est v starte posledney igri komandy 1? esli da, to last1=true i pribovlaem ego minuti k summe minut 
        for (var j = 0; j < teamLast.first().find('st').length; j++) {
             if($(this).find('id').text()==teamLast.first().find('st').get(j).innerHTML){
                last1=true;
                sumlast1= +sumlast1 + +$(this).find('min').text();
             }
        }
        //tekushiy player est na zamene proshloy igri komandi 1? Esli da, to lzam1=true
        for (var j = 0; j < teamLast.first().find('zm').length; j++) {
             if($(this).find('id').text()==teamLast.first().find('zm').get(j).innerHTML)
                lzam1=true;
        }


        var l1="";
        if(last1)
           l1="green_circle"; 
        if(lzam1)
           l1="yellow_circle";

        for (var j = 0; j < teamLast.eq(1).find('st').length; j++) {
             if($(this).find('id').text()==teamLast.eq(1).find('st').get(j).innerHTML){
                last2=true;
                sumlast2=+sumlast2 + +$(this).find('min').text();
             }
        }

        for (var j = 0; j < teamLast.eq(1).find('zm').length; j++) {
             if($(this).find('id').text()==teamLast.eq(1).find('zm').get(j).innerHTML)
                lzam2=true;
        }
        
        var l2="";
        if(last2)
           l2="green_circle";    
        if(lzam2)
           l2="yellow_circle";  


        for (var j = 0; j < teamLast.eq(2).find('st').length; j++) {
             if($(this).find('id').text()==teamLast.eq(2).find('st').get(j).innerHTML){
                last3=true;
                sumlast3=+sumlast3 + +$(this).find('min').text();
             }
        }
        for (var j = 0; j < teamLast.eq(2).find('zm').length; j++) {
             if($(this).find('id').text()==teamLast.eq(2).find('zm').get(j).innerHTML)
                lzam3=true;
        }
        
        var l3="";
        if(last3)
           l3="green_circle";    
        if(lzam3)
           l3="yellow_circle"; 

        var checked=(osn=="red_circle")?"checked":"";


        $('#cl'+i).find('#buttonPanel'+teamNumber).append('<div class="buttonPanelRow" id="b'+plind+'"><span class="squad_application"><input id="squad_application'+plind+'" onclick="drawSquadApplication('+teamNumber+','+i+','+plind+')" type="checkbox" '+checked+'></span></div>');
        //zapolnaem statistiku tekushego player v tablice
        $('#'+i+'teamData'+teamNumber).append('<div class="teamDataRow '+odd+'" id="t'+plind+'"><span class="shirtnumber_cell">'+$(this).find('num').text()+'</span><span class="name_cell">'+$(this).find('name').text()+'</span><span class="squad_preliminary_table '+znakpred+'"></span><span class="squad_start_table '+osn+'"></span><span class="last_game_1 '+l1+'"></span><span class="last_game_2 '+l2+'"></span><span class="last_game_3 '+l3+'"></span><span class="age_cell">'+$(this).find('age').text()+'</span><span class="position_cell">'+$(this).find('pos').text()+'</span><span class="game_minutes_cell">'+$(this).find('min').text()+'</span><span class="appearances_cell">'+$(this).find('app').text()+'</span><span class="lineups_cell">'+$(this).find('lnu').text()+'</span><span class="subs_in_cell">'+$(this).find('sin').text()+'</span><span class="subs_out_cell">'+$(this).find('sout').text()+'</span><span class="subs_on_bench_cell">'+$(this).find('sob').text()+'</span><span class="goals_cell">'+$(this).find('goals').text()+'</span><span class="assists_cell" style="color: rgb(153, 153, 153);">'+$(this).find('ass').text()+'</span><span class="yellow_cards_cell">'+$(this).find('yc').text()+'</span><span class="yellow_2_cards_cell">'+$(this).find('yr').text()+'</span><span class="red_cards_cell">'+$(this).find('rc').text()+'</span></div>');
        
        knt=knt+1;
        odd="even";
          if(knt%2==0)
            odd="odd";

        //esli kolchestvo tekushego players ravno vsego players, to zapolnyaem stroku result
        if(knt==vsegoplayers){
        	
        	$('#cl'+i).find('#buttonPanel'+teamNumber).append('<div class="buttonPanelRow" id="resbut'+teamNumber+'" style="font-size:9pt;"><b><i>'+klkvstarte+'</b></i>');
            
	        $('#cl'+i).find('#teamTable'+teamNumber).prepend('<div class="teamDataRow odd"><span class="shirtnumber_cell"></span><span class="name_cell" style="padding-left:30px;"><i><b>Result:</b></i></span><span></span><span style="font-size:9pt;padding-right:5px;padding-left:30px;" id="'+i+'resultstart'+teamNumber+'"><i><b>'+((sumstart/sumitogo)*100).toString().substring(0,4)+'<br>%</b></i></span><span style="font-size:9pt;padding-right:5px;"><i><b>'+((sumlast1/sumitogo)*100).toString().substring(0,4)+'<br>%</b></i></span><span style="font-size:9pt;padding-right:5px;"><i><b>'+((sumlast2/sumitogo)*100).toString().substring(0,4)+'<br>%</b></i></span><span style="font-size:9pt;"><i><b>'+((sumlast3/sumitogo)*100).toString().substring(0,4)+'<br>%</b></i></span></div>');

            sumatop11starta[teamNumber]=sumitogo;
            sumavstarte[teamNumber]=sumstart;
        }
        plind++;
	});
    
}


function getStatForWelcomeTable(teamNumber,a,sumstart,sumitogo,klkvstarte){
	var start=$(a).find('st'+teamNumber);
	var knt=0;

   var sopkof=[];

    //kazdiy igrok iz starta
    for (var j = 0; j < start.length; j++) {
	     //esli id=-1, to sravnivaem po familiam
	    if(start[j].childNodes[1].innerHTML==-1){
	    	var i=0;
	    	var arr=[];
	    	var allkof=[];
	    	var allname=[];
            //dly kazdogo igroka iz spiska komandy
	     	$(a).find('team'+teamNumber).find('players').each(function(){
		        //summa minut pervih 11
		        if(knt<11)
		           sumitogo=+sumitogo + +$(this).find('min').text();
		     	//schitaem kof
		     	var kf=sopostav($(this).find('name').text(),start[j].childNodes[2].innerHTML);
		        if(kf>0.85){
                    arr[i]=kf;
		        	i++;
		        	arr[i]=$(this).find('min').text();
		        	i++;
		        	arr[i]=$(this).find('name').text();
		        	i++;
		            //console.log(start1[j].childNodes[2].innerHTML+' '+$(this).find('name').text()+' '+kf);
		        }
		        allkof.push(kf);
		        allname[kf]=$(this).find('name').text();
		        knt++;
		    });
		    sopkof[j]=arr;
		    //console.log('-----------------------------------');
            if(arr.length==0){
            }
            else{
            	if(arr.length==3){
            		sumstart=+sumstart + +arr[1];
            		klkvstarte++;
            	}
            	else{
            		var arrsop=[];
            		var t=0;
            		var textstr='';
            		var maxkf=0;
            		var maxkfindex=0;            		
            		for(var e=0;e<arr.length;e=e+3){
            			if(arr[e]>maxkf){
            				maxkf=arr[e]
            				maxkfindex=e;
            		    }
            			if(e==arr.length-3)
            				textstr+=arr[e+2]+'('+arr[e]+','+arr[e+1]+')';
            			else
            				textstr+=arr[e+2]+'('+arr[e]+','+arr[e+1]+') и ';
            		}
            		sumstart=+sumstart + +arr[maxkfindex+1];
            		klkvstarte++;        		
            	}
            }
        }
	    else{
	    	$(a).find('team'+teamNumber).find('players').each(function(){
	    		if(knt<11)
		           sumitogo=+sumitogo + +$(this).find('min').text();
		        knt++;
		        if($(this).find('id').text()==start[j].childNodes[1].innerHTML){
		            sumstart=+sumstart + +$(this).find('min').text();
		            klkvstarte++;
		        }
		    });
	     }

    }
    var mas=[sumstart,sumitogo,klkvstarte]; 
	return mas;
}


function formModal(i){
	if($('#a'+i).length==0){
		 $('.modals').append('<div id="a'+i+'">');          
	    var gam=obj[i];
		var feed=$(gam).find('feed').first().text();                              
	    var team1name=$(gam).find('team1').find('name').first().text();
	    var team2name=$(gam).find('team2').find('name').first().text();
	    var namegame=team1name+'-'+team2name;
	    var team1last=$(gam).find('team1').find('lastGame');
	    var team2last=$(gam).find('team2').find('lastGame');
	    

	    var sumstart=0;
		var sumitogo=0;
		var klkvstarte=0;  

	    formTable(1,gam,team1last,i,namegame,team1name,sumstart,sumitogo,klkvstarte,feed);
		formTable(2,gam,team2last,i,namegame,team2name,sumstart,sumitogo,klkvstarte,feed);
	}
}
				   	   	
function show(){
         //zapuskaem taimer
         time(new Date(new Date().getTime()+60000));	  	
	     
	     //zapros ajax
	     $.ajax({
		    type:'get',//тип запроса: get,post либо head
            url:'squad/api/refresh',
		    //url:'http://tool-tool.7e14.starter-us-west-2.openshiftapps.com/squad/api/adminrefresh',
            //url:'test.xml',
		    //prishel otvet ajax v xml
		    success:function (data) { //возвращаемый результат от сервера
                        var filtrvalue=70;
                        //esli v pole vvedeno chislo, to zapisivaem v filtrvalue ego, inache znachenie 70
                        if(!isNaN(document.getElementById('filtr').value))
                           filtrvalue=document.getElementById('filtr').value;

	                    //udalaem modalnie okna krome otkritogo 
						var sohrmodal=deleteModalsWithoutOpen()
                        
                        //ochichaem content - tam gde tablicsa matchey
                        $('.content').empty();
                        //dobavlaem tablicu s matchami v content
                        $('.content').append('<table class="table table-hover" id="tab0">');
                        $('#tab0').append('<thead><tr><th>Date</th><th>Tournament</th><th>Game</th><th>Team1</th><th>Team2</th><th>Feed</th><th>Line up time</th></tr>');
                        $('#tab0').append('<tbody id="tabGam">');
                        

                        var i=0;
                        var klkgame=0;                   
 
                        //dly kazdoy game iz xml
				    	$(data).find('game').each(function(){
				    		i=i+1;
 

	                        //propuskaem otkritoe okno
	                        if(i==sohrmodal)
	                           i=i+1;
	                        /*
	                        //dobavlaem modalnoe okno dly game
	                        $('.modals').append('<div id="a'+i+'">');
	                        */
	                        var date=$(this).find('date').first().text()+' '+$(this).find('time').first().text();
	                        var tournam=$(this).find('tournam').first().text();
	                        var feed=$(this).find('feed').first().text(); 
	                        var timestart=$(this).find('startTime').first().text();                   

	                        var team1name=$(this).find('team1').find('name').first().text();
	                        var team2name=$(this).find('team2').find('name').first().text();
	                        var namegame=team1name+'-'+team2name;


	                        var team1last=$(this).find('team1').find('lastGame');
	                        var team2last=$(this).find('team2').find('lastGame');
	                        

							var sumstart=0;
						    var sumitogo=0;
                            //kolichestvo igrokov starta sopostavlenih po id i number v kazdoy komande
	                        var klkvstarte1=0;
	                        var klkvstarte2=0;   
	                       
	                        var mas=getStatForWelcomeTable(1,this,sumstart,sumitogo,klkvstarte1);
                            
                            sumstart=mas[0];
                            sumitogo=mas[1];
                            klkvstarte1=mas[2];
                            
                            //To ze amoe dly team2
							var sumitogo2=0;
							var sumstart2=0;
                            var mas2=getStatForWelcomeTable(2,this,sumstart2,sumitogo2,klkvstarte2);
	                        
	                        sumstart2=mas2[0];
	                        sumitogo2=mas2[1];
	                        klkvstarte2=mas2[2];
	                        
	                        //podsvetka matchey v spiske i sam spisok
	                        var podsvetka="";
	                        if((((sumstart2/sumitogo2)*100)<filtrvalue) || (((sumstart/sumitogo)*100)<filtrvalue)){
	                        	podsvetka='style="background-color: #58FA58";';
	                        }
	                        if(feed==0)
	                        	podsvetka='style="background-color: #A9E2F3";';


                            obj[i]=this;
	                        //zapolnyaem spisok matchey v tablice v content
	                        $('#tabGam').append('<tr '+podsvetka+'><td>'+date+'</td><td>'+tournam+'</td><td><a href="#" data-toggle="modal" data-target="#'+i+'" onclick="formModal('+i+')">'+namegame+'</a></td><td>'+((sumstart/sumitogo)*100).toString().substring(0,4)+'% ('+klkvstarte1+')</td><td>'+((sumstart2/sumitogo2)*100).toString().substring(0,4)+'% ('+klkvstarte2+')</td><td>'+feed+'</td><td>'+timestart+'</td></tr>');
                            
							klkgame++;
                        //konec each game
						});

						//delaem zvuk (pri odnovremeom otnimaniy i plusovamiy matchey mogut bit oshibki)
	                    if(klkgame>klkgamevtable){
	                    	for(var m=0;m<(klkgame-klkgamevtable);m++){
	                    		var st=document.getElementById("tabGam").getElementsByTagName("tr")[m].getAttribute("style");
		                    	if(document.getElementById("tabGam").getElementsByTagName("tr")[m].getAttribute("style")=="background-color: #58FA58"){
		                    		sound();
		                    	}
		                    }	                    	
	                    }

	                    klkgamevtable=klkgame;
	        //konec datasuccess 
			}
        //konec ajax
		});
//konec function show
}


$(document).ready(function(){
              show();
              setInterval('show()',60000);
});	   
	   
</script>


<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Стартовые составы</title>
</head>
<body>
  <audio id="chatAudio"><source src="notify.ogg" type="audio/ogg"><source src="notify.mp3" type="audio/mpeg"><source src="notify.wav" type="audio/wav"></audio>
  <label for="filtr" style="margin:10px 20px;">Подсветка матчей с % сыграных минут стартового состава менее:</label>
  <input type="text" value="70" id="filtr">
<i style="position:relative;float:right;margin-top:-40px;font-size:20px">Автообновление через <span id="t" style="font-size:20px"></span></i>
<div class="content" style="margin:20px 20px;"></div>
<div class="modals"></div>
</body>
</html>


<style>


div#buttonPanel1{
	/*float: left;*/
	display: inline-table;
	margin-right: 10px;
	white-space: normal; /* отменить действие "white-space: nowrap" в div.teamTable */}


div#buttonPanel2{
	display: inline-table;
	margin-left: 10px;
	white-space: normal;
}

/* заголовок панели кнопок */
div.buttonPanelTitle {
	display: table-row;
	height: 25px;
}

div.buttonPanelTitle span {
	display: table-cell;
	vertical-align: middle;
}


div#textFormat1, div#textFormat2 {
	margin: 0 0 20px 0;
	padding: 5px;
	box-sizing: border-box;
	font: 12px arial,helvetica,clean,sans-serif;
	border: solid 1px rgb(150,150,150);
}

div#textFormatTop1, div#textFormatTop2 {
	margin: 0 0 20px 0;
	padding: 5px;
	min-height: 20px;
	box-sizing: border-box;
	font: 12px arial,helvetica,clean,sans-serif;
	border: solid 1px rgb(150,150,150);
}

/* основной блок команды 1 */
.modal-dialog{
	max-width:1300px;
}

div#team1 {
	display: inline-block;
	margin: 0px;
}

/* основной блок команды 2 */
div#team2 {
	display: inline-block;
	margin: 0px 10px 10px 10px;
	vertical-align: top;
}


/* блок, объединяющий блок панели кнопок и блок данных о команде */
div#teamTable1, div#teamTable2 {
	white-space: nowrap; /* отменить перенос блоков на следующую "строку" */
}



/* блок данных о команде */
div.teamData1, div.teamData2 {
	display: inline-table;
	position: relative; /* для абсолютного размещения водяного знака "Betfront.ru" относительно этого блока */
	font: 12px arial,helvetica,clean,sans-serif;
	border: solid 1px rgb(150,150,150);
	vertical-align: top;
	white-space: normal; /* отменить действие "white-space: nowrap" в div.teamTable */
}

/* заголовок блока данных о команде */
div.teamDataTitle {
	display: table-row;
	height: 25px;
	font-weight: bold;
	background-color: rgb(244,244,244);
}

div.teamDataTitle span {
	display: table-cell;
	vertical-align: middle;
}

/* строки */
div.buttonPanelRow, div.teamDataRow {
	display: table-row;
	height: 25px;
}

div.buttonPanelRow span, div.teamDataRow span {
	display: table-cell;
	vertical-align: middle;
}

/* четная строка ДОБАВИТЬ "И ЗАГОЛОВОК" */ 
div.even {
	background-color: rgb(244,244,244);
}

/* нечетная строка */
div.odd {
	background-color: white;
}

/* РАЗДЕЛ "СТАТУС ИГРОКА" */

/* заголовок */
span.player_status_title {
	margin-left: 2px;
	font: 12px arial,helvetica,clean,sans-serif;
	font-weight: bold;
	text-align: left;
}

/* список */
span.player_status option {
	font-size: 12px;
	font-family: tahoma;
}

/* РАЗДЕЛ "ПРЕДВАРИТЕЛЬНЫЙ И ЗАЯВОЧНЫЙ СОСТАВЫ" */

/* предварительный состав */
span.squad_preliminary {
	width: 16px;
	padding-left: 5px;
	text-align: center;
}

/* заявочный состав */
span.squad_application {
	width: 16px;
	padding-left: 0px;
	text-align: center;
}

/* РАДИО-КНОПКИ "СТАРТОВЫЙ СОСТАВ" */

/* играет */
span.now_game_start {
	width: 16px;
	padding-left: 20px;
	text-align: center;
}

/* замена */
span.now_game_subs {
	width: 16px;
	padding-left: 5px;
	text-align: center;
}

/* не играет */
span.now_game_not_play {
	width: 16px;
	padding-left: 5px;
	text-align: center;
}

/* ТАБЛИЦА */

/* игровой номер */
span.shirtnumber {
	width: 30px;
	min-width: 30px;
	max-width: 30px;
}

span.shirtnumber_cell {
	padding: 0 6px 0 2px;
	text-align: right;
}


/* имя */
span.name {
	width: 124px;
	max-width: 124px;
	padding-left: 6px;
}

span.name_cell {
	width: 124px;
	max-width: 124px;
	padding-left: 6px;
	font-size: 13px;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}



/* СТАТУС ИГРОКА (В ТАБЛИЦЕ) */

span.player_status_table {
	width: 14px;
	background-position: center center;
	border-right: 3px solid transparent; /* аналог padding-right для фоновых изображений */
}


/* предварительный состав */
span.squad_preliminary_table {
	width: 14px;
	padding: 0 2px;
	background-position: center center;
}

/* заявочный состав */
span.squad_application_table {
	width: 14px;
	background-position: right center;
}

/* стартовый состав */
span.squad_start_table {
	width: 14px;
	padding-right: 0px;
	padding-right:5px;
	background-position: left center;
}

/* флаг */
span.flag {
    width: 8px;
}

/* вспомогательный блок для отображения флага */
span.flag_conteiner {
	width: 16px;
	height: 14px;
}

/* прошлая игра 1 (левый столбец) */
span.last_game_1 {
	width: 10px;
	padding-right: 8px;
	background-position: right center;
}

/* заголовок */
span#last_game1_team1_title, span#last_game1_team2_title {
	padding-right: 2px;
	text-align: right;
	font-size: 8px;
	font-weight: normal;
}

/* прошлая игра 2 (центральный столбец) */
span.last_game_2 {
	width: 10px;
	padding: 0 2px;
	background-position: center center;
}

/* заголовок */
span#last_game2_team1_title, span#last_game2_team2_title {
	padding: 0;
	text-align: center;
	font-size: 8px;
	font-weight: normal;
}

/* прошлая игра 3 (правый столбец) */
span.last_game_3 {
	width: 10px;
	padding-left: 8px;
	background-position: left center;
}

/* заголовок */
span#last_game3_team1_title, span#last_game3_team2_title {
	padding-left: 2px;
	text-align: left;
	font-size: 8px;
	font-weight: normal;
}

/* КРУЖКИ */

/* зеленый кружок */
span.green_circle {
	background-image: url('image/circle/green.png');
	background-repeat: no-repeat;
}

/* желтый кружок */
span.yellow_circle {
	background-image: url('image/circle/yellow.png');
	background-repeat: no-repeat;
}

/* красный кружок */
span.red_circle {
	background-image: url('image/circle/red.png');
	background-repeat: no-repeat;
}

/* синий кружок */
span.blue_circle {
	background-image: url('image/circle/blue.png');
	background-repeat: no-repeat;
}

/* черный кружок */
span.black_circle {
	background-image: url('../image/circle/black.png');
	background-repeat: no-repeat;
}

/* возраст */
span.age {
	width: 14px;
	padding-right: 5px;
	text-align: center;
}

span.age_cell {
	text-align: center;
	padding-right: 5px;
}

/* позиция */
span.position {
	width: 12px; /* 16px */
	padding: 0 2px 0 2px;
	text-align: center;
}

span.position_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* сыграно минут */
span.game_minutes {
	width: 37px; /* 43px */
	padding: 0 4px 0 2px;
    text-align: right;
	background-color: rgb(187,187,187);
}

span.game_minutes_cell {
	padding: 0 4px 0 2px;
	text-align: right;
}

/* выходы на поле */
span.appearances {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.appearances_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* стартовые составы */
span.lineups {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.lineups_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* выход на замену */
span.subs_in {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.subs_in_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* замена */
span.subs_out {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.subs_out_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* выходы на замену */
span.subs_on_bench {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.subs_on_bench_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* голы */
span.goals {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.goals_cell {
	padding: 0 2px 0 2px;
	text-align: center;}

/* голевые передачи */
span.assists {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.assists_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* желтые карточки */
span.yellow_cards {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.yellow_cards_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* вторые желтые/красные карточки */
span.yellow_2_cards {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.yellow_2_cards_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}

/* красные карточки */
span.red_cards {
	width: 20px;
	padding: 0 2px 0 2px;
    text-align: center;
}

span.red_cards_cell {
	padding: 0 2px 0 2px;
	text-align: center;
}
</style>

<style>
/* ОСНОВНЫЕ ПРАВИЛА СТИЛЕЙ (+ ГЛАВНАЯ СТРАНИЦА???) */

* {
	margin: 0;
	padding: 0;
}

html {
	height: 100%;
}

body {
	height: 100%;
	white-space: nowrap;
}
</style>


